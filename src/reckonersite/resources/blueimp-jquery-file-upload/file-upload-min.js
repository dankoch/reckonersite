(function(a){"use strict";var b=function(a,c){var d=/[^\-\w]/.test(a)?new Function(b.arg,("var _s=''"+b.helper+";_s+='"+a.replace(b.regexp,b.func)+"';return _s;").split("_s+='';").join("")):b.cache[a]=b.cache[a]||b(b.load(a));return d.tmpl=d.tmpl||b,c?d(c):d};b.cache={},b.load=function(a){return document.getElementById(a).innerHTML},b.regexp=/(\s+)|('|\\)(?![^%]*%\})|(?:\{%(=|#)(.+?)%\})|(\{%)|(%\})/g,b.func=function(a,b,c,d,e,f,g,h,i){if(b)return h&&h+a.length!==i.length?" ":"";if(c)return"\\"+a;if(d)return d==="="?"'+_e("+e+")+'":"'+("+e+"||'')+'";if(f)return"';";if(g)return"_s+='"},b.encReg=/[<>&"\x00]/g,b.encMap={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","\0":""},b.encode=function(a){return String(a||"").replace(b.encReg,function(a){return b.encMap[a]})},b.arg="o",b.helper=",_t=arguments.callee.tmpl,_e=_t.encode,print=function(s,e){_s+=e&&(s||'')||_e(s);},include=function(s,d){_s+=_t(s,d);}",typeof define=="function"&&define.amd?define(function(){return b}):a.tmpl=b})(this);(function(a){"use strict";var b=function(a,c,d){var e=document.createElement("img"),f,g;return e.onerror=c,e.onload=function(){g&&b.revokeObjectURL(g),c(b.scale(e,d))},window.Blob&&a instanceof Blob||window.File&&a instanceof File?f=g=b.createObjectURL(a):f=a,f?(e.src=f,e):b.readFile(a,function(a){e.src=a})},c=window.createObjectURL&&window||window.URL&&URL||window.webkitURL&&webkitURL;b.scale=function(a,b){b=b||{};var c=document.createElement("canvas"),d=Math.max((b.minWidth||a.width)/a.width,(b.minHeight||a.height)/a.height);return d>1&&(a.width=parseInt(a.width*d,10),a.height=parseInt(a.height*d,10)),d=Math.min((b.maxWidth||a.width)/a.width,(b.maxHeight||a.height)/a.height),d<1&&(a.width=parseInt(a.width*d,10),a.height=parseInt(a.height*d,10)),!b.canvas||!c.getContext?a:(c.width=a.width,c.height=a.height,c.getContext("2d").drawImage(a,0,0,a.width,a.height),c)},b.createObjectURL=function(a){return c?c.createObjectURL(a):!1},b.revokeObjectURL=function(a){return c?c.revokeObjectURL(a):!1},b.readFile=function(a,b){if(window.FileReader&&FileReader.prototype.readAsDataURL){var c=new FileReader;return c.onload=function(a){b(a.target.result)},c.readAsDataURL(a),c}return!1},typeof define!="undefined"&&define.amd?define(function(){return b}):a.loadImage=b})(this);(function($){'use strict';var counter=0;$.ajaxTransport('iframe',function(options){if(options.async&&(options.type==='POST'||options.type==='GET')){var form,iframe;return{send:function(_,completeCallback){form=$('<form style="display:none;"></form>');iframe=$('<iframe src="javascript:false;" name="iframe-transport-'+(counter+=1)+'"></iframe>').bind('load',function(){var fileInputClones;iframe.unbind('load').bind('load',function(){var response;try{response=iframe.contents();if(!response.length||!response[0].firstChild){throw new Error()}}catch(e){response=undefined}completeCallback(200,'success',{'iframe':response});$('<iframe src="javascript:false;"></iframe>').appendTo(form);form.remove()});form.prop('target',iframe.prop('name')).prop('action',options.url).prop('method',options.type);if(options.formData){$.each(options.formData,function(index,field){$('<input type="hidden"/>').prop('name',field.name).val(field.value).appendTo(form)})}if(options.fileInput&&options.fileInput.length&&options.type==='POST'){fileInputClones=options.fileInput.clone();options.fileInput.after(function(index){return fileInputClones[index]});if(options.paramName){options.fileInput.each(function(){$(this).prop('name',options.paramName)})}form.append(options.fileInput).prop('enctype','multipart/form-data').prop('encoding','multipart/form-data')}form.submit();if(fileInputClones&&fileInputClones.length){options.fileInput.each(function(index,input){var clone=$(fileInputClones[index]);$(input).prop('name',clone.prop('name'));clone.replaceWith(input)})}});form.append(iframe).appendTo(document.body)},abort:function(){if(iframe){iframe.unbind('load').prop('src','javascript'.concat(':false;'))}if(form){form.remove()}}}}});$.ajaxSetup({converters:{'iframe text':function(iframe){return $(iframe[0].body).text()},'iframe json':function(iframe){return $.parseJSON($(iframe[0].body).text())},'iframe html':function(iframe){return $(iframe[0].body).html()},'iframe script':function(iframe){return $.globalEval($(iframe[0].body).text())}}})}(jQuery));(function($){'use strict';if(window.XDomainRequest){jQuery.ajaxTransport(function(s){if(s.crossDomain&&s.async){if(s.timeout){s.xdrTimeout=s.timeout;delete s.timeout}var xdr;return{send:function(headers,completeCallback){function callback(status,statusText,responses,responseHeaders){xdr.onload=xdr.onerror=xdr.ontimeout=jQuery.noop;xdr=null;completeCallback(status,statusText,responses,responseHeaders)}xdr=new XDomainRequest();if(s.type==='DELETE'){s.url=s.url+(/\?/.test(s.url)?'&':'?')+'_method=DELETE';s.type='POST'}else if(s.type==='PUT'){s.url=s.url+(/\?/.test(s.url)?'&':'?')+'_method=PUT';s.type='POST'}xdr.open(s.type,s.url);xdr.onload=function(){callback(200,'OK',{text:xdr.responseText},'Content-Type: '+xdr.contentType)};xdr.onerror=function(){callback(404,'Not Found')};if(s.xdrTimeout){xdr.ontimeout=function(){callback(0,'timeout')};xdr.timeout=s.xdrTimeout}xdr.send((s.hasContent&&s.data)||null)},abort:function(){if(xdr){xdr.onerror=jQuery.noop();xdr.abort()}}}}})}}(jQuery));(function($){'use strict';$.widget('blueimp.fileupload',{options:{namespace:undefined,dropZone:$(document),fileInput:undefined,replaceFileInput:true,paramName:undefined,singleFileUploads:true,limitMultiFileUploads:undefined,sequentialUploads:false,limitConcurrentUploads:undefined,forceIframeTransport:false,postMessage:undefined,multipart:true,maxChunkSize:undefined,uploadedBytes:undefined,recalculateProgress:true,formData:function(form){return form.serializeArray()},add:function(e,data){data.submit()},processData:false,contentType:false,cache:false},_refreshOptionsList:['namespace','dropZone','fileInput'],_isXHRUpload:function(options){var undef='undefined';return!options.forceIframeTransport&&typeof XMLHttpRequestUpload!==undef&&typeof File!==undef&&(!options.multipart||typeof FormData!==undef)},_getFormData:function(options){var formData;if(typeof options.formData==='function'){return options.formData(options.form)}else if($.isArray(options.formData)){return options.formData}else if(options.formData){formData=[];$.each(options.formData,function(name,value){formData.push({name:name,value:value})});return formData}return[]},_getTotal:function(files){var total=0;$.each(files,function(index,file){total+=file.size||1});return total},_onProgress:function(e,data){if(e.lengthComputable){var total=data.total||this._getTotal(data.files),loaded=parseInt(e.loaded/e.total*(data.chunkSize||total),10)+(data.uploadedBytes||0);this._loaded+=loaded-(data.loaded||data.uploadedBytes||0);data.lengthComputable=true;data.loaded=loaded;data.total=total;this._trigger('progress',e,data);this._trigger('progressall',e,{lengthComputable:true,loaded:this._loaded,total:this._total})}},_initProgressListener:function(options){var that=this,xhr=options.xhr?options.xhr():$.ajaxSettings.xhr();if(xhr.upload&&xhr.upload.addEventListener){xhr.upload.addEventListener('progress',function(e){that._onProgress(e,options)},false);options.xhr=function(){return xhr}}},_initXHRData:function(options){var formData,file=options.files[0];if(!options.multipart||options.blob){options.headers=$.extend(options.headers,{'X-File-Name':file.name,'X-File-Type':file.type,'X-File-Size':file.size});if(!options.blob){options.contentType=file.type;options.data=file}else if(!options.multipart){options.contentType='application/octet-stream';options.data=options.blob}}if(options.multipart&&typeof FormData!=='undefined'){if(options.postMessage){formData=this._getFormData(options);if(options.blob){formData.push({name:options.paramName,value:options.blob})}else{$.each(options.files,function(index,file){formData.push({name:options.paramName,value:file})})}}else{if(options.formData instanceof FormData){formData=options.formData}else{formData=new FormData();$.each(this._getFormData(options),function(index,field){formData.append(field.name,field.value)})}if(options.blob){formData.append(options.paramName,options.blob)}else{$.each(options.files,function(index,file){if(file instanceof Blob){formData.append(options.paramName,file)}})}}options.data=formData}options.blob=null},_initIframeSettings:function(options){options.dataType='iframe '+(options.dataType||'');options.formData=this._getFormData(options)},_initDataSettings:function(options){if(this._isXHRUpload(options)){if(!this._chunkedUpload(options,true)){if(!options.data){this._initXHRData(options)}this._initProgressListener(options)}if(options.postMessage){options.dataType='postmessage '+(options.dataType||'')}}else{this._initIframeSettings(options,'iframe')}},_initFormSettings:function(options){if(!options.form||!options.form.length){options.form=$(options.fileInput.prop('form'))}if(!options.paramName){options.paramName=options.fileInput.prop('name')||'files[]'}if(!options.url){options.url=options.form.prop('action')||location.href}options.type=(options.type||options.form.prop('method')||'').toUpperCase();if(options.type!=='POST'&&options.type!=='PUT'){options.type='POST'}},_getAJAXSettings:function(data){var options=$.extend({},this.options,data);this._initFormSettings(options);this._initDataSettings(options);return options},_enhancePromise:function(promise){promise.success=promise.done;promise.error=promise.fail;promise.complete=promise.always;return promise},_getXHRPromise:function(resolveOrReject,context,args){var dfd=$.Deferred(),promise=dfd.promise();context=context||this.options.context||promise;if(resolveOrReject===true){dfd.resolveWith(context,args)}else if(resolveOrReject===false){dfd.rejectWith(context,args)}promise.abort=dfd.promise;return this._enhancePromise(promise)},_chunkedUpload:function(options,testOnly){var that=this,file=options.files[0],fs=file.size,ub=options.uploadedBytes=options.uploadedBytes||0,mcs=options.maxChunkSize||fs,slice=file.webkitSlice||file.mozSlice||file.slice,upload,n,jqXHR,pipe;if(!(this._isXHRUpload(options)&&slice&&(ub||mcs<fs))||options.data){return false}if(testOnly){return true}if(ub>=fs){file.error='uploadedBytes';return this._getXHRPromise(false,options.context,[null,'error',file.error])}n=Math.ceil((fs-ub)/mcs);upload=function(i){if(!i){return that._getXHRPromise(true,options.context)}return upload(i-=1).pipe(function(){var o=$.extend({},options);o.blob=slice.call(file,ub+i*mcs,ub+(i+1)*mcs);o.chunkSize=o.blob.size;that._initXHRData(o);that._initProgressListener(o);jqXHR=($.ajax(o)||that._getXHRPromise(false,o.context)).done(function(){if(!o.loaded){that._onProgress($.Event('progress',{lengthComputable:true,loaded:o.chunkSize,total:o.chunkSize}),o)}options.uploadedBytes=o.uploadedBytes+=o.chunkSize});return jqXHR})};pipe=upload(n);pipe.abort=function(){return jqXHR.abort()};return this._enhancePromise(pipe)},_beforeSend:function(e,data){if(this._active===0){this._trigger('start')}this._active+=1;this._loaded+=data.uploadedBytes||0;this._total+=this._getTotal(data.files)},_onDone:function(result,textStatus,jqXHR,options){if(!this._isXHRUpload(options)){this._onProgress($.Event('progress',{lengthComputable:true,loaded:1,total:1}),options)}options.result=result;options.textStatus=textStatus;options.jqXHR=jqXHR;this._trigger('done',null,options)},_onFail:function(jqXHR,textStatus,errorThrown,options){options.jqXHR=jqXHR;options.textStatus=textStatus;options.errorThrown=errorThrown;this._trigger('fail',null,options);if(options.recalculateProgress){this._loaded-=options.loaded||options.uploadedBytes||0;this._total-=options.total||this._getTotal(options.files)}},_onAlways:function(jqXHRorResult,textStatus,jqXHRorError,options){this._active-=1;options.textStatus=textStatus;if(jqXHRorError&&jqXHRorError.always){options.jqXHR=jqXHRorError;options.result=jqXHRorResult}else{options.jqXHR=jqXHRorResult;options.errorThrown=jqXHRorError}this._trigger('always',null,options);if(this._active===0){this._trigger('stop');this._loaded=this._total=0}},_onSend:function(e,data){var that=this,jqXHR,slot,pipe,options=that._getAJAXSettings(data),send=function(resolve,args){that._sending+=1;jqXHR=jqXHR||((resolve!==false&&that._trigger('send',e,options)!==false&&(that._chunkedUpload(options)||$.ajax(options)))||that._getXHRPromise(false,options.context,args)).done(function(result,textStatus,jqXHR){that._onDone(result,textStatus,jqXHR,options)}).fail(function(jqXHR,textStatus,errorThrown){that._onFail(jqXHR,textStatus,errorThrown,options)}).always(function(jqXHRorResult,textStatus,jqXHRorError){that._sending-=1;that._onAlways(jqXHRorResult,textStatus,jqXHRorError,options);if(options.limitConcurrentUploads&&options.limitConcurrentUploads>that._sending){var nextSlot=that._slots.shift();while(nextSlot){if(!nextSlot.isRejected()){nextSlot.resolve();break}nextSlot=that._slots.shift()}}});return jqXHR};this._beforeSend(e,options);if(this.options.sequentialUploads||(this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending)){if(this.options.limitConcurrentUploads>1){slot=$.Deferred();this._slots.push(slot);pipe=slot.pipe(send)}else{pipe=(this._sequence=this._sequence.pipe(send,send))}pipe.abort=function(){var args=[undefined,'abort','abort'];if(!jqXHR){if(slot){slot.rejectWith(args)}return send(false,args)}return jqXHR.abort()};return this._enhancePromise(pipe)}return send()},_onAdd:function(e,data){var that=this,result=true,options=$.extend({},this.options,data),limit=options.limitMultiFileUploads,fileSet,i;if(!(options.singleFileUploads||limit)||!this._isXHRUpload(options)){fileSet=[data.files]}else if(!options.singleFileUploads&&limit){fileSet=[];for(i=0;i<data.files.length;i+=limit){fileSet.push(data.files.slice(i,i+limit))}}data.originalFiles=data.files;$.each(fileSet||data.files,function(index,element){var files=fileSet?element:[element],newData=$.extend({},data,{files:files});newData.submit=function(){newData.jqXHR=this.jqXHR=(that._trigger('submit',e,this)!==false)&&that._onSend(e,this);return this.jqXHR};return(result=that._trigger('add',e,newData))});return result},_normalizeFile:function(index,file){if(file.name===undefined&&file.size===undefined){file.name=file.fileName;file.size=file.fileSize}},_replaceFileInput:function(input){var inputClone=input.clone(true);$('<form></form>').append(inputClone)[0].reset();input.after(inputClone).detach();$.cleanData(input.unbind('remove'));this.options.fileInput=this.options.fileInput.map(function(i,el){if(el===input[0]){return inputClone[0]}return el});if(input[0]===this.element[0]){this.element=inputClone}},_onChange:function(e){var that=e.data.fileupload,data={files:$.each($.makeArray(e.target.files),that._normalizeFile),fileInput:$(e.target),form:$(e.target.form)};if(!data.files.length){data.files=[{name:e.target.value.replace(/^.*\\/,'')}]}if(that.options.replaceFileInput){that._replaceFileInput(data.fileInput)}if(that._trigger('change',e,data)===false||that._onAdd(e,data)===false){return false}},_onPaste:function(e){var that=e.data.fileupload,cbd=e.originalEvent.clipboardData,items=(cbd&&cbd.items)||[],data={files:[]};$.each(items,function(index,item){var file=item.getAsFile&&item.getAsFile();if(file){data.files.push(file)}});if(that._trigger('paste',e,data)===false||that._onAdd(e,data)===false){return false}},_onDrop:function(e){var that=e.data.fileupload,dataTransfer=e.dataTransfer=e.originalEvent.dataTransfer,data={files:$.each($.makeArray(dataTransfer&&dataTransfer.files),that._normalizeFile)};if(that._trigger('drop',e,data)===false||that._onAdd(e,data)===false){return false}e.preventDefault()},_onDragOver:function(e){var that=e.data.fileupload,dataTransfer=e.dataTransfer=e.originalEvent.dataTransfer;if(that._trigger('dragover',e)===false){return false}if(dataTransfer){dataTransfer.dropEffect=dataTransfer.effectAllowed='copy'}e.preventDefault()},_initEventHandlers:function(){var ns=this.options.namespace||this.widgetName;this.options.dropZone.bind('dragover.'+ns,{fileupload:this},this._onDragOver).bind('drop.'+ns,{fileupload:this},this._onDrop).bind('paste.'+ns,{fileupload:this},this._onPaste);this.options.fileInput.bind('change.'+ns,{fileupload:this},this._onChange)},_destroyEventHandlers:function(){var ns=this.options.namespace||this.widgetName;this.options.dropZone.unbind('dragover.'+ns,this._onDragOver).unbind('drop.'+ns,this._onDrop).unbind('paste.'+ns,this._onPaste);this.options.fileInput.unbind('change.'+ns,this._onChange)},_beforeSetOption:function(key,value){this._destroyEventHandlers()},_afterSetOption:function(key,value){var options=this.options;if(!options.fileInput){options.fileInput=$()}if(!options.dropZone){options.dropZone=$()}this._initEventHandlers()},_setOption:function(key,value){var refresh=$.inArray(key,this._refreshOptionsList)!==-1;if(refresh){this._beforeSetOption(key,value)}$.Widget.prototype._setOption.call(this,key,value);if(refresh){this._afterSetOption(key,value)}},_create:function(){var options=this.options;if(options.fileInput===undefined){options.fileInput=this.element.is('input:file')?this.element:this.element.find('input:file')}else if(!options.fileInput){options.fileInput=$()}if(!options.dropZone){options.dropZone=$()}this._slots=[];this._sequence=this._getXHRPromise(true);this._sending=this._active=this._loaded=this._total=0;this._initEventHandlers()},destroy:function(){this._destroyEventHandlers();$.Widget.prototype.destroy.call(this)},enable:function(){$.Widget.prototype.enable.call(this);this._initEventHandlers()},disable:function(){this._destroyEventHandlers();$.Widget.prototype.disable.call(this)},add:function(data){if(!data||this.options.disabled){return}data.files=$.each($.makeArray(data.files),this._normalizeFile);this._onAdd(null,data)},send:function(data){if(data&&!this.options.disabled){data.files=$.each($.makeArray(data.files),this._normalizeFile);if(data.files.length){return this._onSend(null,data)}}return this._getXHRPromise(false,data&&data.context)}})}(jQuery));(function($){'use strict';$.widget('blueimpUI.fileupload',$.blueimp.fileupload,{options:{autoUpload:false,maxNumberOfFiles:undefined,maxFileSize:undefined,minFileSize:1,acceptFileTypes:/.+$/i,previewFileTypes:/^image\/(gif|jpeg|png)$/,previewMaxWidth:80,previewMaxHeight:80,previewAsCanvas:true,dataType:'json',add:function(e,data){var that=$(this).data('fileupload'),files=data.files;that._adjustMaxNumberOfFiles(-files.length);data.isAdjusted=true;data.files.valid=data.isValidated=that._validate(files);data.context=that._renderUpload(files).appendTo($(this).find('.files')).fadeIn(function(){$(this).show()}).data('data',data);if((that.options.autoUpload||data.autoUpload)&&data.isValidated){data.submit()}},send:function(e,data){if(!data.isValidated){var that=$(this).data('fileupload');if(!data.isAdjusted){that._adjustMaxNumberOfFiles(-data.files.length)}if(!that._validate(data.files)){return false}}if(data.context&&data.dataType&&data.dataType.substr(0,6)==='iframe'){data.context.find('.ui-progressbar').progressbar('value',parseInt(100,10))}},done:function(e,data){var that=$(this).data('fileupload');if(data.context){data.context.each(function(index){var file=($.isArray(data.result)&&data.result[index])||{error:'emptyResult'};if(file.error){that._adjustMaxNumberOfFiles(1)}$(this).fadeOut(function(){that._renderDownload([file]).css('display','none').replaceAll(this).fadeIn(function(){$(this).show()})})})}else{that._renderDownload(data.result).css('display','none').appendTo($(this).find('.files')).fadeIn(function(){$(this).show()})}},fail:function(e,data){var that=$(this).data('fileupload');that._adjustMaxNumberOfFiles(data.files.length);if(data.context){data.context.each(function(index){$(this).fadeOut(function(){if(data.errorThrown!=='abort'){var file=data.files[index];file.error=file.error||data.errorThrown||true;that._renderDownload([file]).css('display','none').replaceAll(this).fadeIn(function(){$(this).show()})}else{data.context.remove()}})})}else if(data.errorThrown!=='abort'){that._adjustMaxNumberOfFiles(-data.files.length);data.context=that._renderUpload(data.files).css('display','none').appendTo($(this).find('.files')).fadeIn(function(){$(this).show()}).data('data',data)}},progress:function(e,data){if(data.context){data.context.find('.ui-progressbar').progressbar('value',parseInt(data.loaded/data.total*100,10))}},progressall:function(e,data){$(this).find('.fileupload-progressbar').progressbar('value',parseInt(data.loaded/data.total*100,10))},start:function(){$(this).find('.fileupload-progressbar').progressbar('value',0).fadeIn()},stop:function(){$(this).find('.fileupload-progressbar').fadeOut()},destroy:function(e,data){var that=$(this).data('fileupload');if(data.url){data.url=data.url.split(" ").join("");data.type=data.type.split(" ").join("");$.ajax(data).success(function(){that._adjustMaxNumberOfFiles(1);$(this).fadeOut(function(){$(this).remove()})})}else{that._adjustMaxNumberOfFiles(1);data.context.fadeOut(function(){$(this).remove()})}}},_enableDragToDesktop:function(){var link=$(this),url=link.prop('href'),name=decodeURIComponent(url.split('/').pop()).replace(/:/g,'-'),type='application/octet-stream';link.bind('dragstart',function(e){try{e.originalEvent.dataTransfer.setData('DownloadURL',[type,name,url].join(':'))}catch(err){}})},_adjustMaxNumberOfFiles:function(operand){if(typeof this.options.maxNumberOfFiles==='number'){this.options.maxNumberOfFiles+=operand;if(this.options.maxNumberOfFiles<1){this._disableFileInputButton()}else{this._enableFileInputButton()}}},_formatFileSize:function(bytes){if(typeof bytes!=='number'){return''}if(bytes>=1000000000){return(bytes/1000000000).toFixed(2)+' GB'}if(bytes>=1000000){return(bytes/1000000).toFixed(2)+' MB'}return(bytes/1000).toFixed(2)+' KB'},_hasError:function(file){if(file.error){return file.error}if(this.options.maxNumberOfFiles<0){return'maxNumberOfFiles'}if(!(this.options.acceptFileTypes.test(file.type)||this.options.acceptFileTypes.test(file.name))){return'acceptFileTypes'}if(this.options.maxFileSize&&file.size>this.options.maxFileSize){return'maxFileSize'}if(typeof file.size==='number'&&file.size<this.options.minFileSize){return'minFileSize'}return null},_validate:function(files){var that=this,valid=!!files.length;$.each(files,function(index,file){file.error=that._hasError(file);if(file.error){valid=false}});return valid},_renderTemplate:function(func,files){return $(this.options.templateContainer).html(func({files:files,formatFileSize:this._formatFileSize,options:this.options})).children()},_renderUpload:function(files){var options=this.options,nodes=this._renderTemplate(options.uploadTemplate,files).css('display','none'),firstNode=nodes.first();firstNode.find('.progress div').progressbar();firstNode.find('.start button').button({text:false,icons:{primary:'ui-icon-circle-arrow-e'}});firstNode.find('.cancel button').button({text:false,icons:{primary:'ui-icon-cancel'}});nodes.find('.preview').each(function(index,node){var file=files[index];if(options.previewFileTypes.test(file.type)){window.loadImage(files[index],function(img){$(img).hide().appendTo(node).fadeIn()},{maxWidth:options.previewMaxWidth,maxHeight:options.previewMaxHeight,canvas:options.previewAsCanvas})}});return nodes},_renderDownload:function(files){var nodes=this._renderTemplate(this.options.downloadTemplate,files).css('display','none');nodes.find('.delete button').button({text:false,icons:{primary:'ui-icon-trash'}});nodes.find('a').each(this._enableDragToDesktop);return nodes},_startHandler:function(e){e.preventDefault();var tmpl=$(this).closest('.template-upload'),data=tmpl.data('data');if(data&&data.submit&&!data.jqXHR&&data.submit()){$(this).fadeOut()}},_cancelHandler:function(e){e.preventDefault();var tmpl=$(this).closest('.template-upload'),data=tmpl.data('data')||{};if(!data.jqXHR){data.errorThrown='abort';e.data.fileupload._trigger('fail',e,data)}else{data.jqXHR.abort()}},_deleteHandler:function(e){e.preventDefault();var button=$(this);e.data.fileupload._trigger('destroy',e,{context:button.closest('.template-download'),url:button.attr('data-url'),type:button.attr('data-type'),dataType:e.data.fileupload.options.dataType})},_initEventHandlers:function(){$.blueimp.fileupload.prototype._initEventHandlers.call(this);var eventData={fileupload:this};this.element.find('.files').delegate('.start button','click.'+this.options.namespace,eventData,this._startHandler).delegate('.cancel button','click.'+this.options.namespace,eventData,this._cancelHandler).delegate('.delete button','click.'+this.options.namespace,eventData,this._deleteHandler)},_destroyEventHandlers:function(){this.element.find('.files').undelegate('.start button','click.'+this.options.namespace).undelegate('.cancel button','click.'+this.options.namespace).undelegate('.delete button','click.'+this.options.namespace);$.blueimp.fileupload.prototype._destroyEventHandlers.call(this)},_initFileUploadButtonBar:function(){var fileUploadButtonBar=this.element.find('.fileupload-buttonbar'),filesList=this.element.find('.files'),ns=this.options.namespace;fileUploadButtonBar.addClass('ui-widget-header ui-corner-top');this.element.find('.fileinput-button').each(function(){var fileInput=$(this).find('input:file').detach();$(this).button({icons:{primary:'ui-icon-plusthick'}}).append(fileInput)});fileUploadButtonBar.find('.start').button({icons:{primary:'ui-icon-circle-arrow-e'}}).bind('click.'+ns,function(e){e.preventDefault();filesList.find('.start button').click()});fileUploadButtonBar.find('.cancel').button({icons:{primary:'ui-icon-cancel'}}).bind('click.'+ns,function(e){e.preventDefault();filesList.find('.cancel button').click()});fileUploadButtonBar.find('.delete').button({icons:{primary:'ui-icon-trash'}}).bind('click.'+ns,function(e){e.preventDefault();filesList.find('.delete input:checked').siblings('button').click()});fileUploadButtonBar.find('.toggle').bind('change.'+ns,function(e){filesList.find('.delete input').prop('checked',$(this).is(':checked'))})},_destroyFileUploadButtonBar:function(){this.element.find('.fileupload-buttonbar').removeClass('ui-widget-header ui-corner-top');this.element.find('.fileinput-button').each(function(){var fileInput=$(this).find('input:file').detach();$(this).button('destroy').append(fileInput)});this.element.find('.fileupload-buttonbar button').unbind('click.'+this.options.namespace).button('destroy');this.element.find('.fileupload-buttonbar .toggle').unbind('change.'+this.options.namespace)},_enableFileInputButton:function(){this.element.find('.fileinput-button input:file:disabled').each(function(){var fileInput=$(this),button=fileInput.parent();fileInput.detach().prop('disabled',false);button.button('enable').append(fileInput)})},_disableFileInputButton:function(){this.element.find('.fileinput-button input:file:enabled').each(function(){var fileInput=$(this),button=fileInput.parent();fileInput.detach().prop('disabled',true);button.button('disable').append(fileInput)})},_initTemplates:function(){this.options.templateContainer=document.createElement(this.element.find('.files').prop('nodeName'));this.options.uploadTemplate=window.tmpl('template-upload');this.options.downloadTemplate=window.tmpl('template-download')},_create:function(){$.blueimp.fileupload.prototype._create.call(this);this._initTemplates();this.element.addClass('ui-widget');this._initFileUploadButtonBar();this.element.find('.fileupload-content').addClass('ui-widget-content ui-corner-bottom');this.element.find('.fileupload-progressbar').hide().progressbar()},destroy:function(){this.element.find('.fileupload-progressbar').progressbar('destroy');this.element.find('.fileupload-content').removeClass('ui-widget-content ui-corner-bottom');this._destroyFileUploadButtonBar();this.element.removeClass('ui-widget');$.blueimp.fileupload.prototype.destroy.call(this)},enable:function(){$.blueimp.fileupload.prototype.enable.call(this);this.element.find(':ui-button').not('.fileinput-button').button('enable');this._enableFileInputButton()},disable:function(){this.element.find(':ui-button').not('.fileinput-button').button('disable');this._disableFileInputButton();$.blueimp.fileupload.prototype.disable.call(this)}})}(jQuery));